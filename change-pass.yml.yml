---
- hosts:
  become: yes
  gather_facts: no
  vars_prompt:
  
  - name: username
    prompt: "Type username"
    private: no
  - name: password
    prompt: "Type password"

  tasks:
  - name: check user
    shell: cat /etc/passwd | grep "{{username}}" | awk -F ":" '{print$1}'
    changed_when: false
    register: user
  
  - name: change password
    user:
     name: "{{username}}"
     update_password: always
     password: "{{password | password_hash('sha512')}}"
    when: user.stdout == username